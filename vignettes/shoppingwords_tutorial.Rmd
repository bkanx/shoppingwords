---
title: "shoppingwords: A Guide to Using the Package"
output: rmarkdown::html_vignette
date: "`r Sys.Date()`"
vignette: >
  %\VignetteIndexEntry{shoppingwords: A Guide to Using the Package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
#| include = FALSE
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Overview

The shoppingwords package provides functions for loading, normalizing, and analyzing textual data, primarily from user reviews. This tutorial covers dataset loading from CSV, JSON, and RDS formats, as well as text normalization by removing stopwords, extracting phrases, and includes labeled polarity datasets.

# Installation

Before using shoppingwords, install it from CRAN via:

```{r}
#| eval: false
install.packages("shoppingwords")
```

or install the development version from GitHub via:

```{r}
#| eval: false
pak::pak("bkanx/shoppingwords")
```

# Packages

For this vignette we will use the shoppingwords, knitr, kableExtra, tibble, and dplyr packages:

```{r}
#| message: false
library(shoppingwords)
library(knitr)
library(tibble)
library(dplyr)
```

# Loading Datasets

The **shoppingwords** package provides several datasets useful for text processing and analysis. This section introduces the datasets stored in the `datasets/` folder, explaining their contents and showing how to load them into R.


## Available Datasets

The following datasets are included in the package:

| Dataset Name                 | Format  | Description |
|-----------------------------|--------|-------------|
| `corrected_words_10137.csv`  | CSV    | A collection of corrected words for text normalization. |
| `corrected_words_10137.json` | JSON   | The same corrected words dataset, stored in JSON format. |
| `corrected_words_10137.rds`  | RDS    | Serialized version of corrected words for quick loading. |
| `phrases.csv`                | CSV    | A dataset containing predefined phrases for analysis. |
| `review_raw_v1_1.rds`        | RDS    | Raw review data for sentiment analysis and NLP tasks. |
| `stopwords_tr.csv`           | CSV    | A list of Turkish stopwords including shopping-based terms for text preprocessing. |
| `testdata.csv`               | CSV    | Sample test data including sentence-based polarity for further NLP tasks. |


The review_**`raw_v1_1.rds`** dataset is the core component of the shoppingwords package, designed for text analysis, sentiment scoring, or NLP tasks (e.g., customer feedback mining). The **`load_dataset()`** function provides a convenient way to load datasets by specifying their name and format.

### Loading Reviews Dataset

The package stores review data in an optimized RDS format for fast access. The **`load_dataset()`** function loads the main dataset of product reviews from an RDS file stored within the package. 

#### **Dataset Structure**
| Column   | Description |
|----------|-------------|
| `rating` | Numerical rating (1-5) from user reviews. |
| `text`   | Review content, including product opinions. |
|


```{r}
#| message: false
#| eval: false
# Load reviews from RDS
reviews <- load_dataset("review_raw_v1_1", "rds") 
head(reviews, 3)
str(reviews)
```


```{r}
#| message: false
#| echo: false
# Load reviews from RDS
reviews <- load_dataset("review_raw_v1_1", "rds") 
head(reviews, 3)
str(reviews)
```

All other functions (e.g., stopword removal, phrase analysis) are optimized for the **`review_raw_v1_1.rds`** dataset. It enables analysis of Turkish e-commerce reviews (e.g., rating scores, common complaints).

To demonstrate a practical analytical use case for the preprocessed review data and how the package's functions work together in a real analysis workflow is given in the Examples. The example calculates if longer reviews correlate with higher/lower ratings - a common business question in review analysis.


```{r}
#| message: false
# Preprocess reviews  
cleaned_reviews <- match_stopwords(reviews)  # Remove stopwords  

# Analyze sentiment vs. ratings  
library(dplyr)  
cleaned_reviews |>    
  group_by(rating) |>   
  summarise(avg_text_length = mean(nchar(cleaned_text)))  
```



### Loading Corrected Words

The `load_dataset()` function allows users to load a predefined dataset of corrected words from within the package. Users can choose between **CSV**, **RDS** or **JSON** format. The function restructures CSV data into a **long format** for easier text analysis. It is a restructured spelling variants or slang (e.g., "fiyattt" → "fiyat") for further text analysis. The **˜corrected_words˜** dataset contains 10,137 pairs of commonly misspelled Turkish words and their corrected versions, particularly useful for normalizing shopping-related text.


```{r}
#| message: false
#| eval: false
# Load corrected words from JSON
corrected_words <- load_dataset("corrected_words", "json")
```


```{r}
#| message: false
#| echo: false
# Load corrected words from JSON
corrected_words <- load_dataset("corrected_words", "json")[c(41,44,68)]
head(corrected_words)
```



### Loading Stopwords

The `load_dataset()` function also retrieves a predefined list of 92 stopwords from a CSV file stored within the package. These stopwords are commonly found in Turkish shopping-related text and are useful for text preprocessing and analysis. stopwords_tr is a dataset specific to Turkish stopwords.

```{r}
#| message: false
#| eval: false
# Load Turkish shopping-based stopwords from csv
stopwords <- load_dataset("stopwords_tr", "csv")

```

```{r}
#| message: false
#| echo: false
# Load Turkish shopping-based stopwords from csv
stopwords <- shoppingwords::load_dataset("stopwords_tr", "csv")
stopwords |> dplyr::slice(38:41)
```

stopwords-iso is a standardized multilingual stopword collection, including Turkish but potentially with broader coverage.

```{r}
#| message: false
#| echo: false
# or load a few stopwords from stopwords-iso 
stopwords::stopwords("tr", source = "stopwords-iso") |> head()

```
Using both datasets reduces the risk of missing critical stopwords that could skew sentiment or topic modeling results.


### Loading Phrases

The `load_dataset()` function also retrieves predefined shopping-related phrases from a CSV file stored within the package. 

```{r}
#| message: false
#| eval: false
# Load predefined Turkish shopping-based phrases
shopping_phrases <- load_dataset("phrases","csv")
```

```{r}
#| message: false
#| echo: false
shopping_phrases <- load_dataset("phrases","csv")
head(shopping_phrases)
```

These phrases assist in text processing, linguistic analysis, and Natural Language Processing (NLP) applications, making it easier to analyze customer behavior and responses.


### Cleaning text

The `match_stopwords()` is a function that processes user reviews by removing predefined stopwords while preserving the original rating scores. It takes a dataframe with "comment" and "rating" columns, cleans each review by filtering out stopwords from both custom stopword lists and stopwords-iso, and returns a dataframe with an additional "cleaned_text" column for further analysis. This function helps in text normalization for sentiment analysis and rating-based insights.


```{r}
#| message: false
#| eval: false

reviews_sample <- tibble(
    comment = c("Bu ürün gerçekten çok iyi ancak fiyatı sadece yüksek gibi", 
                "Fiyat çok pahalı ama kaliteli iyi"), 
    rating = c(4.5, 3.0)
)

cleaned_sample <- match_stopwords(reviews_sample) # expects a real data frame, not a name in quotes
```

```{r}
#| echo: false
#| message: false
reviews_sample <- tibble(
    rating = c(4.5, 3.0),
    comment = c("Bu ürün gerçekten çok iyi ancak fiyatı sadece yüksek gibi", 
                "Fiyat çok pahalı ama kaliteli iyi")
    
)
cleaned_sample <- match_stopwords(reviews_sample)
kable(cleaned_sample) 
```

Alternatively, users might pass the selected reviews to match_stopwords():

```{r}
#| echo: false
#| message: false
# or using a few reviews from raw data 
reviews <- load_dataset("review_raw_v1_1", "rds")
reviews_sample <- reviews[1000:1005,]
reviews_sample <-  match_stopwords(reviews_sample)
kable(reviews_sample)
```


## Sentiment Polarity Dataset

The `shoppingwords` package also includes a **sentiment polarity dataset** for text mining and NLP tasks. This dataset contains user-generated reviews labeled as **positive (`p`)** or **negative (`n`)**, being different than reviews data and making it useful for training models in sentiment classification.

#### **Dataset Structure**
| Column   | Description |
|----------|-------------|
| `rating` | Numerical rating (1-5) from user reviews. |
| `text`   | Review content, including product opinions. |
| `emotion` | Sentiment label (`p`: positive, `n`: negative). |

### **Loading the Testdata**


```{r}
#| message: false
#| echo: false
# Load polarity dataset
polarity_data <- load_dataset("testdata", "csv")
head(polarity_data)
```

Once loaded, users can analyze the dataset:

```{r}
#| message: false
#| 
# Count positive vs. negative reviews
polarity_data |> 
  count(emotion, sort = TRUE)
```

Summarizing the occurrences of rating and emotion in relation to negative and positive reviews is insightful. Notably,  204 reviews contain negative expressions even though they have been assigned a rating of 5, out of a total of 2244 reviews.

```{r}
# Occurences of rating and emotion
polarity_data |> 
  count(rating, emotion, sort = TRUE) |> 
  arrange(desc(rating))
```

The testdata can be used in various ways such as capturing the negative expressions or predciting sentence-level polarity using the **`review_raw_v1_1.rds`** dataset. 


# References
Kan, B., Cetinkaya-Rundel, M. & Rundel, C. (2023). shoppingwords: Text Processing Tools for Turkish E-Commerce Data. R package version 0.1.0.
Available at: https://github.com/bkanx/shoppingwords


Wickham, H., François, R., Henry, L., Müller, K., & Vaughan, D. (2023). dplyr: A Grammar of Data Manipulation. R package version 1.1.2.
URL: https://CRAN.R-project.org/package=dplyr


Xie, Y. (2023). knitr: A General-Purpose Package for Dynamic Report Generation in R. R package version 1.43.
URL: https://yihui.org/knitr/


Zhu, H. (2021). kableExtra: Construct Complex Table with 'kable' and Pipe Syntax. R package version 1.3.4.
URL: https://CRAN.R-project.org/package=kableExtra


Müller, K., & Wickham, H. (2023). tibble: Simple Data Frames. R package version 3.2.1.
URL: https://CRAN.R-project.org/package=tibble


Benoit, K., Muhr, D., & Watanabe, K. (2021). stopwords: Multilingual Stopword Lists. R package version 2.3.
URL: https://CRAN.R-project.org/package=stopwords


Csárdi, G. (2022). pak: A Fresh Approach to R Package Installation. R package version 0.3.1.
URL: https://CRAN.R-project.org/package=pak
